# 演習の準備
1. Chrome ブラウザで Google アカウントにログインしていることを確認します。ログインしていない場合は、Google アカウントにログインしてください。
2. 以下のリンクを Chrome ブラウザの新しいタブで開きます。  
   https://shell.cloud.google.com
   
3. 開いた Cloud Shell の画面のターミナル (下半分の部分) に以下のコマンドをコピー＆ペーストで入力して実行します。
   ```
   git clone https://github.com/trainocate-japan/extending_genai_with_langchain.git
   cd ./extending_genai_with_langchain/chapter4/exercise3
   ```
   
4. 以下のコマンドを実行して Python の仮想環境を作成します。
   ```
   python -m venv venv
   source venv/bin/activate
   ```
   
5. 以下のコマンドを実行して必要な Python パッケージをインストールします。
   ```
   pip install -q -r requirements.txt
   ```

6. Cloud Shell Editor (画面上半分の部分) の左ナビゲーションで [Explorer] アイコンをクリックします。
7. [**Open Folder**] をクリックします。
8. `/homne/YOUR_NAME/extending_genai_with_langchain/chapter4/exercise3/` と入力し [**OK**] をクリックします。(YOUR_NAME の部分はご自身のアカウント名になります)  
   いくつかポップアップでメッセージが表示された場合は、[×] で閉じて構いません。

9. Explorer 部分を右クリックして、[**New File**] をクリックします。
10. `.env` という名前のファイルを作成します。エディタで編集画面のタブが開くので、以下のように API キーを保存します。(YOUR_KEY の部分には実際の各キーの値を入力してください)
    ファイルは自動保存されます。
    ```
    OPENAI_API_KEY="YOUR_KEY"
    LANGCHAIN_API_KEY="YOUR_KEY"
    PINECONE_API_KEY="YOUR_KEY"
    ```

# Streamlit の概要
1. `streamlit_demo.py` を使用して講師が Streamlit アプリケーションのデモを行います。

2. 以下のコマンドでアプリケーションを実行することができます。
   ```
   streamlit run streamlit_demo.py --server.enableCORS=false
   ```

3. 画面上部の [**ウェブでプレビュー**] アイコンをクリックし、[**ポートを変更**] をクリックします。

4. [**ポート番号**] に `8501` と入力し、[**変更してプレビュー**] をクリックします。

5. ブラウザで新しいタブが開き、アプリケーションの画面が表示されます。

6. ターミナルで `Ctrl` + `C` を入力するとアプリケーションが終了します。


# 演習
Streamlit を使用したチャットボット アプリケーションを作成します。  
このアプリケーションでは、任意の PDF ファイルをアップロードし、チャットで質問するとその PDF ファイルの内容に基づいた回答を得ることができます。  

1. Explorer で `ask_my_pdf.py` をクリックし、編集画面を開きます。

2. このコード内には **TASK** と記載された箇所が 8 箇所あります。それぞれの TASK の指示にしたがって不足しているコードを作成し、コードを完成させてください。

3. この演習は、ハンズオンで使用した `implement_rag.ipynb` のコードを参考にしながら行ってください。わからない場合は、正解のコードが記載されている `ask_my_pdf_solution.py` を見ながらコードを作成しても構いません。(それでも十分に演習の効果はあります)

4. コードの作成が完了したら、ターミナルで以下のコマンドでアプリケーションを実行します。
   ```
   streamlit run ask_my_pdf.py --server.enableCORS=false
   ```

5. 画面上部の [**ウェブでプレビュー**] アイコンをクリックし、[**ポートを変更**] をクリックします。

6. [**ポート番号**] に `8501` と入力し、[**変更してプレビュー**] をクリックします。

7. ブラウザで新しいタブが開き、アプリケーションの画面が表示されます。

8. エラーが表示された場合は、アプリケーションを終了してコードを修正してください。
   ターミナルで `Ctrl` + `C` を入力するとアプリケーションが終了します。

9. エラーが表示されずアプリケーションの画面が表示されたら、まず既存のインデックスを削除した上で任意の PDF ファイルをアップロードし、チャットで質問してみてください。

10. チャットで回答が得られたら LangSmith で想定通りの処理フローが実行されていることを確認します。

11. チャットでいろいろな質問をして動作や精度を確認してみてください。

